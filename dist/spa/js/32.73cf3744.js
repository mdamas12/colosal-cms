(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[32],{5255:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",[a("div",{staticClass:"col-md-12 col-xs-12 q-pa-sm"},[a("div",{staticClass:"column items-end"},[a("div",{staticClass:"col"},[a("div",{staticClass:"row"},[a("q-btn",{staticClass:"q-pa-xs q-ma-md float-right",attrs:{color:"red-10",label:"Crear compra"},on:{click:function(t){return e.$router.push({path:"sales/create"})}}})],1)])]),a("div",{staticClass:"q-pa-md"},[a("q-input",{attrs:{outlined:"","bottom-slots":"",label:"Buscar",counter:""},scopedSlots:e._u([{key:"before",fn:function(){return[a("q-icon",{attrs:{name:"account_circle"}})]},proxy:!0},{key:"append",fn:function(){return[""!==e.text?a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"close"},on:{click:function(t){e.text=""}}}):e._e(),a("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:e.text,callback:function(t){e.text=t},expression:"text"}}),a("q-tabs",{staticClass:"q-mb-lg",attrs:{align:"justify","narrow-indicator":""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[a("q-tab",{staticClass:"text-red",attrs:{name:"validate",label:"Por validar"}},[e.toValidate.length>0?a("div",[a("q-badge",{staticClass:"q-mb-xl",attrs:{rounded:"",color:"red",label:e.toValidate.length,floating:""}})],1):e._e()]),a("q-tab",{staticClass:"text-indigo-10",attrs:{name:"deliver",label:"Por entregar"}},[e.toDeliver.length>0?a("div",[a("q-badge",{attrs:{rounded:"",color:"indigo-10",label:e.toDeliver.length,floating:""}})],1):e._e()]),a("q-tab",{staticClass:"text-green",attrs:{name:"processed",label:"Procesado"}})],1),a("div",{staticClass:"q-gutter-y-sm"},[a("q-tab-panels",{staticClass:"text-center",attrs:{animated:"","transition-prev":"jump-up","transition-next":"jump-down","keep-alive":""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[a("q-tab-panel",{attrs:{name:"validate"}},[a("q-table",{attrs:{title:"Por Validar",data:e.toValidate,columns:e.columns1,"row-key":"id",loading:!e.isValidateFetched},scopedSlots:e._u([{key:"header",fn:function(t){return[a("q-tr",{attrs:{props:t}},[a("q-th",{attrs:{"auto-width":""}}),e._l(t.cols,(function(s){return a("q-th",{key:s.name,attrs:{props:t}},[e._v("\n                      "+e._s(s.label)+"\n                    ")])}))],2)]}},{key:"body",fn:function(t){return[a("q-tr",{attrs:{props:t}},[a("q-td",{attrs:{"auto-width":""}},[a("q-btn",{attrs:{size:"sm",color:"red-10",round:"",dense:"",icon:t.expand?"remove":"add"},on:{click:function(e){t.expand=!t.expand}}})],1),e._l(t.cols,(function(s){return a("q-td",{key:s.name,attrs:{props:t}},[e._v("\n                      "+e._s(s.value)+"\n                    ")])}))],2),a("q-tr",{directives:[{name:"show",rawName:"v-show",value:t.expand,expression:"props.expand"}],attrs:{props:t}},[a("q-td",{attrs:{colspan:"100%"}},[a("div",{staticClass:"column items-end"},[a("div",{staticClass:"row"},[a("q-btn",{staticClass:"q-mr-sm float-right",attrs:{flat:"",round:"",color:"red-10",icon:"delete"},on:{click:function(a){return e.confirmDelete(t.row)}}}),a("q-btn",{staticClass:"q-mr-xs q-pa-xs float-right",attrs:{color:"indigo-10",label:"Validar"},on:{click:function(a){return e.changeSaleStatus(t.row,"POR ENTREGAR")}}})],1)])])],1)]}}])})],1),a("q-tab-panel",{attrs:{name:"deliver"}},[a("q-table",{attrs:{title:"Por Entregar",data:e.toDeliver,columns:e.columns2,"row-key":"id",loading:!e.isDeliverFetched},scopedSlots:e._u([{key:"header",fn:function(t){return[a("q-tr",{attrs:{props:t}},[a("q-th",{attrs:{"auto-width":""}}),e._l(t.cols,(function(s){return a("q-th",{key:s.name,attrs:{props:t}},[e._v("\n                      "+e._s(s.label)+"\n                    ")])}))],2)]}},{key:"body",fn:function(t){return[a("q-tr",{attrs:{props:t}},[a("q-td",{attrs:{"auto-width":""}},[a("q-btn",{attrs:{size:"sm",color:"indigo-10",round:"",dense:"",icon:t.expand?"remove":"add"},on:{click:function(e){t.expand=!t.expand}}})],1),e._l(t.cols,(function(s){return a("q-td",{key:s.name,attrs:{props:t}},[e._v("\n                      "+e._s(s.value)+"\n                    ")])}))],2),a("q-tr",{directives:[{name:"show",rawName:"v-show",value:t.expand,expression:"props.expand"}],attrs:{props:t}},[a("q-td",{attrs:{colspan:"100%"}},[a("div",{staticClass:"column items-end"},[a("div",{staticClass:"row"},[a("q-btn",{staticClass:"q-mr-xs q-pa-xs float-right",attrs:{color:"indigo-10",label:"Regresar"},on:{click:function(a){return e.changeSaleStatus(t.row,"POR VALIDAR")}}}),a("q-btn",{staticClass:"float-right",attrs:{color:"green",label:"Procesar"},on:{click:function(a){return e.changeSaleStatus(t.row,"PROCESADA")}}})],1)])])],1)]}}])})],1),a("q-tab-panel",{attrs:{name:"processed"}},[a("q-table",{attrs:{title:"Procesado",data:e.processed,columns:e.columns3,"row-key":"id",loading:!e.isProcessedFetched},scopedSlots:e._u([{key:"header",fn:function(t){return[a("q-tr",{attrs:{props:t}},[a("q-th",{attrs:{"auto-width":""}}),e._l(t.cols,(function(s){return a("q-th",{key:s.name,attrs:{props:t}},[e._v("\n                      "+e._s(s.label)+"\n                    ")])}))],2)]}},{key:"body",fn:function(t){return[a("q-tr",{attrs:{props:t}},[a("q-td",{attrs:{"auto-width":""}},[a("q-btn",{attrs:{size:"sm",color:"green",round:"",dense:"",icon:t.expand?"remove":"add"},on:{click:function(e){t.expand=!t.expand}}})],1),e._l(t.cols,(function(s){return a("q-td",{key:s.name,attrs:{props:t}},[e._v("\n                      "+e._s(s.value)+"\n                    ")])}))],2),a("q-tr",{directives:[{name:"show",rawName:"v-show",value:t.expand,expression:"props.expand"}],attrs:{props:t}},[a("q-td",{attrs:{colspan:"100%"}},[a("div",{staticClass:"column items-end"},[a("div",{staticClass:"row"},[a("q-btn",{staticClass:"float-right",attrs:{color:"indigo-10",label:"REGRESAR"},on:{click:function(a){return e.changeSaleStatus(t.row,"POR ENTREGAR")}}})],1)])])],1)]}}])})],1)],1)],1)],1)])])},o=[],n=(a("c975"),a("a434"),a("2b0e")),l=(a("f508"),a("6a55")),r=n["default"].extend({data(){return{tab:"validate",text:"",isValidateFetched:!1,isDeliverFetched:!1,isProcessedFetched:!1,toValidate:[{description:"",customer:{},created:"",bank:{},payment_type:"",coin:"",amount:0}],toDeliver:[{description:"",customer:{},created:"",bank:{},payment_type:"",coin:"",amount:0}],processed:[{description:"",customer:{},created:"",bank:{},payment_type:"",coin:"",amount:0}],columns1:[{name:"id",required:!0,label:"Referencia",field:e=>e.id,format:e=>""+e,sortable:!0},{name:"customer",label:"Cliente",field:e=>e.customer,format:e=>""+e.email,sortable:!0},{name:"created",label:"Fecha",field:e=>e.created,format:e=>""+e},{name:"payment_type",label:"Forma de Pago",field:"payment_type",sortable:!0},{name:"bank",label:"Banco",sortable:!0,field:e=>e.bank,format:e=>""+e.name},{name:"coin",label:"Moneda",field:"coin"},{name:"amount",label:"Monto",field:"amount"}],columns2:[{name:"id",required:!0,label:"Referencia",field:e=>e.id,format:e=>""+e,sortable:!0},{name:"customer",label:"Cliente",field:e=>e.customer,format:e=>""+e.email,sortable:!0},{name:"created",label:"Fecha",field:e=>e.created,format:e=>""+e},{name:"payment_type",label:"Forma de Pago",field:"payment_type",sortable:!0},{name:"bank",label:"Banco",sortable:!0,field:e=>e.bank,format:e=>""+e.name},{name:"coin",label:"Moneda",field:"coin"},{name:"amount",label:"Monto",field:"amount"}],columns3:[{name:"id",required:!0,label:"Referencia",field:e=>e.id,format:e=>""+e,sortable:!0},{name:"customer",label:"Cliente",field:e=>e.customer,format:e=>""+e.email,sortable:!0},{name:"created",label:"Fecha",field:e=>e.created,format:e=>""+e},{name:"payment_type",label:"Forma de Pago",field:"payment_type",sortable:!0},{name:"bank",label:"Banco",sortable:!0,field:e=>e.bank,format:e=>""+e.name},{name:"coin",label:"Moneda",field:"coin"},{name:"amount",label:"Monto",field:"amount"}]}},mounted(){const e=this;e.onRequest()},methods:{onRequest(){this.toValidate.pop(),this.toDeliver.pop(),this.processed.pop(),l["a"].getSalesByStatus(1).subscribe({next:e=>{console.log(e);for(let t=0;t<e.length;t++)null==e[t].bank&&(e[t].bank={name:"N/A"}),this.toValidate.push({id:e[t].id,customer:e[t].customer,created:e[t].created.substring(0,10),payment_type:e[t].payment_type,bank:e[t].bank,coin:e[t].coin,amount:e[t].amount,status:e[t].status})},complete:()=>{console.log("[completed]"),this.isValidateFetched=!0,console.log(JSON.stringify(this.toValidate)+JSON.stringify(this.toDeliver)+JSON.stringify(this.processed))}})},changeSaleStatus(e,t){l["a"].updateSaleStatus(e.id,t).subscribe({complete:()=>{"POR VALIDAR"===e.status?this.toValidate.splice(this.toValidate.indexOf(e),1):"POR ENTREGAR"===e.status?this.toDeliver.splice(this.toDeliver.indexOf(e),1):"PROCESADA"===e.status&&this.processed.splice(this.processed.indexOf(e),1),e.status=t,"POR ENTREGAR"===t&&this.isDeliverFetched?this.toDeliver.splice(0,0,e):"PROCESADA"===t&&this.isProcessedFetched?this.processed.splice(0,0,e):"POR VALIDAR"===t&&this.toValidate.splice(0,0,e),console.log("[sale updated]"),console.log(this.toValidate),console.log(this.toDeliver),console.log(this.processed)}})},confirmDelete(e){this.$q.dialog({title:"Confirmar",message:"¿Está seguro de querer eliminar esta venta?",cancel:!0,persistent:!0}).onOk(()=>{this.deleteSale(e)}).onCancel(()=>{})},deleteSale(e){console.log("about to be deleted: ");l["a"].deleteSale(e.id).subscribe({complete:()=>{"POR VALIDAR"===e.status?this.toValidate.splice(this.toValidate.indexOf(e),1):"POR ENTREGAR"===value?this.toDeliver.splice(this.toDeliver.indexOf(e),1):"PROCESADA"===value&&this.processed.splice(this.processed.indexOf(e),1)}})}},watch:{tab:function(){"deliver"!==this.tab||this.isDeliverFetched?"processed"!==this.tab||this.isProcessedFetched||(console.log("current tab: "+this.tab+"\nwas it fetched?: "+this.isProcessedFetched),l["a"].getSalesByStatus(3).subscribe({next:e=>{console.log(e);for(let t=0;t<e.length;t++)null==e[t].bank&&(e[t].bank={name:"N/A"}),this.processed.push({id:e[t].id,customer:e[t].customer,created:e[t].created.substring(0,10),payment_type:e[t].payment_type,bank:e[t].bank,coin:e[t].coin,amount:e[t].amount,status:e[t].status})},complete:()=>{this.isProcessedFetched=!0,console.log(JSON.stringify(this.toValidate)+JSON.stringify(this.toDeliver)+JSON.stringify(this.processed))}})):(console.log("current tab: "+this.tab+"\nwas it fetched?: "+this.isDeliverFetched),l["a"].getSalesByStatus(2).subscribe({next:e=>{console.log(e);for(let t=0;t<e.length;t++)null==e[t].bank&&(e[t].bank={name:"N/A"}),this.toDeliver.push({id:e[t].id,customer:e[t].customer,created:e[t].created.substring(0,10),payment_type:e[t].payment_type,bank:e[t].bank,coin:e[t].coin,amount:e[t].amount,status:e[t].status})},complete:()=>{this.isDeliverFetched=!0,console.log(JSON.stringify(this.toValidate)+JSON.stringify(this.toDeliver)+JSON.stringify(this.processed))}}))}}}),i=r,c=a("2877"),d=a("9989"),u=a("9c40"),p=a("27f9"),m=a("0016"),b=a("429b"),h=a("7460"),f=a("58a81"),g=a("adad"),v=a("823b"),q=a("eaac"),y=a("bd08"),x=a("357e"),k=a("db86"),S=a("eebe"),_=a.n(S),w=Object(c["a"])(i,s,o,!1,null,null,null);t["default"]=w.exports;_()(w,"components",{QPage:d["a"],QBtn:u["a"],QInput:p["a"],QIcon:m["a"],QTabs:b["a"],QTab:h["a"],QBadge:f["a"],QTabPanels:g["a"],QTabPanel:v["a"],QTable:q["a"],QTr:y["a"],QTh:x["a"],QTd:k["a"]})},"6a55":function(e,t,a){"use strict";var s=a("e9b9"),o=a("a748");const n="panel/";class l{getSales(){return s["a"].create(e=>{o["a"].get(n+"sales/").then(t=>{e.next(t.data),e.complete()}).catch(t=>{e.error(t)})})}getSalesByStatus(e){return s["a"].create(t=>{o["a"].get(n+`sales/list-status/${e}/`).then(e=>{t.next(e.data),t.complete()}).catch(e=>{t.error(e)})})}createSale(e){return s["a"].create(t=>{o["a"].post(n+"sales/sale-panel/",{sale:e.sale,sale_detail:e.sale_detail}).then(e=>{console.log(e),t.complete()}).catch(e=>{t.error(e)})})}searchUsers(e){return s["a"].create(t=>{o["a"].get(n+`sales/customer/${e}/`).then(e=>{t.next(e.data),t.complete()}).catch(e=>{t.error(e)})})}getSale(e){return s["a"].create(t=>{console.log("id: "+e),o["a"].get(n+`sales/detail/${e}/`).then(e=>{t.next(e.data),t.complete()}).catch(e=>{t.error(e)})})}updateSale(e){return s["a"].create(t=>{o["a"].put(n+`sales/detail/${e.id}/`,{sale:e.sale,sale_detail:e.sale_detail}).then(e=>{console.log(),t.complete()}).catch(e=>{t.error(e)})})}updateSaleStatus(e,t){return s["a"].create(a=>{o["a"].put(n+`sales/detail/${e}/`,{sale:{status:t}}).then(e=>{console.log(e),a.complete()}).catch(e=>{a.error(e)})})}deleteSale(e){return s["a"].create(t=>{o["a"].delete(n+`sales/detail/${e}/`).then(e=>{console.log(),t.complete()}).catch(e=>{t.error(e)})})}}t["a"]=new l}}]);